#!/usr/bin/env perl
use v5.14;
use utf8;
binmode STDIN, ":utf8";
binmode STDOUT, ":utf8";

my @urls;
@urls = @ARGV if @ARGV;

if (@urls == 0) {
    use Regexp::Common qw/URI/;

    local $/ = undef;
    my $in = <STDIN>;
    @urls = $in =~ m/($RE{URI}{HTTP}{-scheme=>"https?"})/g;
}
else {
    utf8::decode($_) for(@urls);
}

use FindBin;
use lib "$FindBin::Bin/lib";
use Brain;
use Ceis::Extractor;

my $brain = Brain->new;
my $extractor = Ceis::Extractor->new();

for my $url (@urls) {
    $extractor->url($url);

    my $fulltext = $extractor->fulltext;

    my $k_url      = $brain->blob->add($extractor->url);
    my $k_fulltext = $brain->study($fulltext);

    $brain->relation("origin")->add($k_fulltext, $k_url);

    say "read: $url";
}

__END__

=begin USAGE

Pass URLs from argv:

   $0 URL URL...

Or pass URLs from STDIN:

   cat file-with-urls.txt | $0

=cut

